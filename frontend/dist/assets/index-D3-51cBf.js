(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))c(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const x of i.addedNodes)x.tagName==="LINK"&&x.rel==="modulepreload"&&c(x)}).observe(document,{childList:!0,subtree:!0});function s(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerPolicy&&(i.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?i.credentials="include":n.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function c(n){if(n.ep)return;n.ep=!0;const i=s(n);fetch(n.href,i)}})();const y=new WebSocket(`ws://${window.location.hostname}:3000`);let h="left",f=!1,a=!0,u=null,d={paddles:{left:{y:250},right:{y:250}},ball:{x:400,y:300,radius:8},score:{left:0,right:0},countdownText:null},l={paddles:{left:{y:250,dy:0},right:{y:250,dy:0}},ball:{x:400,y:300,radius:8,dx:0,dy:0},score:{left:0,right:0},countdownText:null};const r=document.getElementById("gameCanvas"),o=r.getContext("2d"),v=document.getElementById("messageBox");function w(e){["view-home","view-game","view-register"].forEach(t=>{const s=document.getElementById(t);s&&(s.style.display=t===e?"block":"none")})}function g(e){v&&(v.textContent=e)}var S;(S=document.getElementById("nav-home"))==null||S.addEventListener("click",()=>{f=!1,a=!0,u=null,l={paddles:{left:{y:250,dy:0},right:{y:250,dy:0}},ball:{x:400,y:300,dx:0,dy:0,radius:8},score:{left:0,right:0},countdownText:null},d={paddles:{left:{y:250,dy:0},right:{y:250,dy:0}},ball:{x:400,y:300,radius:8},score:{left:0,right:0},countdownText:null},y&&y.readyState===WebSocket.OPEN&&y.send(JSON.stringify({type:"forfeit"})),o.clearRect(0,0,r.width,r.height),g(""),w("view-home")});var b;(b=document.getElementById("nav-game"))==null||b.addEventListener("click",()=>{console.log("✅ Bouton 'Jouer en local' cliqué !"),f=!0,m(),w("view-game"),history.pushState(null,"","/game"),g("🎮 Jeu local (2 joueurs sur 1 clavier)"),p(()=>a=!1)});var k;(k=document.getElementById("nav-game-online"))==null||k.addEventListener("click",()=>{console.log("✅ Bouton 'Jouer en ligne' cliqué !"),f=!1,a=!0,w("view-game"),history.pushState(null,"","/game"),g("🕓 En attente d’un autre joueur..."),y.send(JSON.stringify({type:"ready"}))});function m(){l.ball={x:400,y:300,dx:Math.random()<.5?4:-4,dy:Math.random()<.5?4:-4,radius:8},l.paddles.left.y=250,l.paddles.right.y=250,l.paddles.left.dy=0,l.paddles.right.dy=0,a=!0}function p(e){let t=3;l.countdownText=t.toString();const s=setInterval(()=>{t--,t>0?l.countdownText=t.toString():t===0?l.countdownText="GO!":(l.countdownText=null,clearInterval(s),e())},1e3)}document.addEventListener("keydown",e=>{const t=e.key==="z"||e.key==="s",s=e.key==="ArrowUp"||e.key==="ArrowDown",c=e.key==="z"||e.key==="ArrowUp"?-5:5;if(f)t&&(l.paddles.left.dy=c),s&&(l.paddles.right.dy=c);else if(e.key==="ArrowUp"||e.key==="ArrowDown"){const n=h;y.send(JSON.stringify({type:"paddleMove",role:n,dy:c}))}});document.addEventListener("keyup",e=>{const t=e.key==="z"||e.key==="s",s=e.key==="ArrowUp"||e.key==="ArrowDown";if(f)t&&(l.paddles.left.dy=0),s&&(l.paddles.right.dy=0);else if(e.key==="ArrowUp"||e.key==="ArrowDown"){const c=h;y.send(JSON.stringify({type:"paddleMove",role:c,dy:0}))}});function A(){if(!f||a)return;const e=l.ball,t=l.paddles;e.x+=e.dx,e.y+=e.dy,t.left.y+=t.left.dy,t.right.y+=t.right.dy,t.left.y=Math.max(0,Math.min(500,t.left.y)),t.right.y=Math.max(0,Math.min(500,t.right.y)),(e.y<=0||e.y>=600)&&(e.dy*=-1),(e.x-e.radius<20&&e.y>t.left.y&&e.y<t.left.y+100||e.x+e.radius>780&&e.y>t.right.y&&e.y<t.right.y+100)&&(e.dx*=-1.05,e.dy*=1.05),e.x<0?(l.score.right++,l.score.right===3?L("🅿️ Droite a gagné !"):(m(),p(()=>a=!1))):e.x>800&&(l.score.left++,l.score.left===3?L("🅿️ Gauche a gagné !"):(m(),p(()=>a=!1)))}function E(){o.clearRect(0,0,r.width,r.height);const e=f?l:d,t=f?l.ball:d.ball;o.fillStyle="#000",o.font="24px Arial",o.fillText(e.score.left.toString(),r.width/4,30),o.fillText(e.score.right.toString(),r.width*3/4,30),o.fillRect(10,e.paddles.left.y,10,100),o.fillRect(780,e.paddles.right.y,10,100),o.beginPath(),o.arc(t.x,t.y,t.radius,0,Math.PI*2),o.fillStyle="red",o.fill(),e.countdownText&&(o.font="72px Arial",o.textAlign="center",o.textBaseline="middle",o.fillStyle="#000",o.fillText(e.countdownText,r.width/2,r.height/2)),u&&(o.font="72px Arial",o.textAlign="center",o.textBaseline="middle",o.fillStyle="#000",o.fillText(u,r.width/2,r.height/2))}function T(){A(),E(),requestAnimationFrame(T)}T();y.addEventListener("message",e=>{const t=JSON.parse(e.data);t.type==="role"&&(h=t.role,g(`🎮 Connecté en tant que ${h==="left"?"🅿️ gauche":"🅿️ droite"}`)),t.type==="state"&&(d=t.state),console.log("🎯 Message reçu :",t),t.type==="forfeit"&&(console.log("💡 Victoire par forfait reçue :",t.message),u=t.message,setTimeout(()=>{u=null,d.score.left=0,d.score.right=0,d.ball={x:400,y:300,radius:8},d.paddles.left.y=250,d.paddles.right.y=250,w("view-home"),g("")},5e3))});function L(e){a=!0,u=e,setTimeout(()=>{u=null,l.score.left=0,l.score.right=0,m(),p(()=>a=!1)},5e3)}
