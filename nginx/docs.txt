Générations certificats de sécurité :

sudo openssl req -x509 -nodes -days 365 -newkey rsa:2048 \
-keyout selfsigned.key -out selfsigned.crt

Voir les ports utilisés :

sudo netstat -tuln
sudo lsof -i -P -n


	- FR
	- Occitanie
	- Perpignan
	- 42 Perpignan
	- Student
	- localhost / nom du domaine
	- email (momillio@student.42perpignan.fr)


mkdir -p nginx/pki/{ca,issued,private,csr,ext}

openssl genrsa -out nginx/pki/private/ca.key 4096
openssl req -x509 -new -nodes -sha256 -days 3650 \
  -key nginx/pki/private/ca.key \
  -out nginx/pki/ca/ca.crt \
  -subj "/CN=Transcendence-Internal-CA"

#NGINX
openssl genrsa -out nginx/pki/private/nginx-client.key 2048

openssl req -new -sha256 \
  -key nginx/pki/private/nginx-client.key \
  -out nginx/pki/csr/nginx-client.csr \
  -subj "/CN=nginx"

openssl x509 -req -sha256 -days 825 \
  -in nginx/pki/csr/nginx-client.csr \
  -CA nginx/pki/ca/ca.crt -CAkey nginx/pki/private/ca.key -CAcreateserial \
  -out nginx/pki/issued/nginx-client.crt \
  -extfile nginx/pki/ext/nginx-client.cnf

# CHANGER LES NOMS DE SERVICE
# clé
openssl genrsa -out nginx/pki/private/users-service.key 2048

# CSR
openssl req -new -sha256 -key nginx/pki/private/blockchain-service.key \
  -out nginx/pki/csr/blockchain-service.csr \
  -subj "/CN=blockchain-service"

# SAN (tu as déjà un fichier, sinon:)
cat > nginx/pki/ext/users-service.san.cnf <<'EOF'
subjectAltName=DNS:users-service
basicConstraints=CA:FALSE
keyUsage = digitalSignature, keyEncipherment
extendedKeyUsage = serverAuth
EOF

# Cert signé par le CA
openssl x509 -req -sha256 -days 825 \
  -in nginx/pki/csr/users-service.csr \
  -CA nginx/pki/ca/ca.crt -CAkey nginx/pki/private/ca.key -CAcreateserial \
  -out nginx/pki/issued/users-service.crt \
  -extfile nginx/pki/ext/users-service.san.cnf

openssl verify -CAfile nginx/pki/ca/ca.crt nginx/pki/issued/auth-service.crt
openssl verify -CAfile nginx/pki/ca/ca.crt nginx/pki/issued/users-service.crt

Pour tester la connexion https:
  -curl -vk https://localhost/users/health
